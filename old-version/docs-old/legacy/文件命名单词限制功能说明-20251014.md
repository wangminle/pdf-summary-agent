# 文件命名单词数量限制功能

## 功能说明

为了简化导出图表PNG文件的命名，脚本新增了对标号后英文单词数量的限制功能。默认情况下，在 `Figure_x_` 或 `Table_x_` 后最多保留 **12个单词**。

## 使用方法

### 默认使用（12个单词）

```bash
python scripts/extract_pdf_assets.py --pdf paper.pdf --preset robust
```

### 自定义单词数量

通过 `--max-caption-words` 参数可以自定义单词数量限制：

```bash
# 限制为8个单词
python scripts/extract_pdf_assets.py --pdf paper.pdf --preset robust --max-caption-words 8

# 限制为15个单词
python scripts/extract_pdf_assets.py --pdf paper.pdf --preset robust --max-caption-words 15
```

## 示例效果

### 原始图注文本
```
Figure 1: Overview of the proposed deep learning architecture for multi-modal feature extraction and fusion in autonomous driving systems
```

### 处理结果

**之前（无限制）**：
```
Figure_1_Overview_of_the_proposed_deep_learning_architecture_for_multi_modal_feature_extraction_and_fusion_in_autonomous_driving_systems.png
```

**现在（默认12个单词）**：
```
Figure_1_Overview_of_the_proposed_deep_learning_architecture_for_multi_modal_feature_extraction.png
```

**自定义（6个单词）**：
```
Figure_1_Overview_of_the_proposed_deep_learning.png
```

## 技术实现

### 核心函数

#### `_limit_words_after_prefix()`
```python
def _limit_words_after_prefix(filename: str, prefix_pattern: str, max_words: int = 12) -> str:
    """
    限制文件名中前缀（如 Figure_1, Table_S1）之后的单词数量。
    """
    parts = filename.split('_')
    if len(parts) <= 2:  # 只有 'Figure_1' 或更少
        return filename
    
    # 前两部分：类型和编号（如 'Figure' + '1'）
    prefix_parts = parts[:2]
    desc_parts = parts[2:]  # 描述部分
    
    # 限制描述部分的单词数量
    if len(desc_parts) > max_words:
        desc_parts = desc_parts[:max_words]
    
    return '_'.join(prefix_parts + desc_parts)
```

### 修改的函数

1. **`sanitize_filename_from_caption()`** - 用于图片（Figure）文件命名
2. **`build_output_basename()`** - 用于表格（Table）文件命名
3. **`extract_figures()`** - 添加 `max_caption_words` 参数
4. **`extract_tables()`** - 添加 `max_caption_words` 参数

### 命令行参数

新增参数：
```
--max-caption-words INT    Max words after figure/table number in filename (default: 12)
```

## 注意事项

1. **单词计数规则**：以下划线 `_` 为分隔符计数单词
2. **前缀不计入**：`Figure_1` 或 `Table_S1` 等前缀不计入单词数
3. **适用范围**：同时适用于图片（Figure）和表格（Table）的命名
4. **字符限制**：除了单词数量限制外，还保留了原有的字符总长度限制（默认160字符）

## 典型应用场景

### 场景1：论文图表批量提取
```bash
python scripts/extract_pdf_assets.py \
  --pdf research_paper.pdf \
  --preset robust \
  --max-caption-words 10
```

### 场景2：需要更短文件名
```bash
python scripts/extract_pdf_assets.py \
  --pdf long_captions.pdf \
  --preset robust \
  --max-caption-words 6
```

### 场景3：需要更完整的描述
```bash
python scripts/extract_pdf_assets.py \
  --pdf detailed_figures.pdf \
  --preset robust \
  --max-caption-words 20
```

## 兼容性

- ✅ 与现有所有功能完全兼容
- ✅ 不影响图表提取的核心逻辑
- ✅ 默认值（12个单词）提供良好的平衡
- ✅ 可通过命令行参数灵活调整

## 更新日期

2025-10-14 

