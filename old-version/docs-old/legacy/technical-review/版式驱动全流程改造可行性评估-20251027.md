# ç‰ˆå¼é©±åŠ¨å…¨æµç¨‹æ”¹é€ å¯è¡Œæ€§è¯„ä¼°

**æ–‡æ¡£æ—¥æœŸ**: 2025-10-27  
**è¯„ä¼°å¯¹è±¡**: è®©ç‰ˆå¼ä¿¡æ¯è´¯ç©¿A+B+Dæ¯ä¸ªé˜¶æ®µçš„æ”¹é€ æ–¹æ¡ˆ  
**è¯„ä¼°è€…**: AIæ¶æ„å®¡æŸ¥  
**çŠ¶æ€**: ğŸ”´ éœ€è¦è°¨æ…è¯„ä¼°

---

## ğŸ“‹ è¯„ä¼°èƒŒæ™¯

### å½“å‰æ¶æ„å¸ˆçš„æ”¹é€ æ–¹æ¡ˆ

æ¶æ„å¸ˆæå‡ºå°†ç‰ˆå¼ä¿¡æ¯ä»"åç½®è°ƒæ•´"æ”¹ä¸º"å…¨æµç¨‹å¼•å¯¼"ï¼Œå…·ä½“åŒ…æ‹¬ï¼š

1. **Step 1 (é”šç‚¹é€‰æ‹©)**: åˆ©ç”¨`vacant_regions`ä¼˜åŒ–æœç´¢ç©ºé—´å’Œè¯„åˆ†
2. **Step 2 (Phase Aæ–‡æœ¬è£åˆ‡)**: ç›´æ¥ä½¿ç”¨`text_blocks`æ›¿ä»£å¯å‘å¼è§„åˆ™
3. **Step 3 (Phase Bå¯¹è±¡å¯¹é½)**: åˆ©ç”¨`in_figure_text`è¯†åˆ«å›¾å†…å¤–å…ƒç´ 
4. **Step 4 (Phase Dåƒç´ å»ç™½è¾¹)**: ç”¨ç‰ˆå¼æ¨¡å‹ç”Ÿæˆå®Œç¾çš„æ–‡æœ¬æ©è†œ

### æ ¸å¿ƒé—®é¢˜

**é—®é¢˜1**: ä»€ä¹ˆæ—¶å€™æµç¨‹ä¼šå¿½ç•¥ç‰ˆå¼ä¿¡æ¯ï¼Ÿ  
**é—®é¢˜2**: å½“å‰ç‰ˆå¼æå–å‡†ç¡®æ€§æ˜¯å¦è¶³å¤Ÿæ”¯æ’‘è¿™ä¸ªå¤§å˜åŒ–ï¼Ÿ

---

## ğŸ” é—®é¢˜1åˆ†æï¼šå½“å‰æµç¨‹ä½•æ—¶å¿½ç•¥ç‰ˆå¼ä¿¡æ¯

### éªŒè¯ç»“æœï¼šâœ… æ¶æ„å¸ˆåˆ†ææ­£ç¡®

#### è¯æ®1ï¼šæ‰§è¡Œé¡ºåºå¯¼è‡´çš„"å¤©ç„¶å¿½ç•¥"

**ä»£ç ä½ç½®**: `extract_figures()` å’Œ `extract_tables()` ä¸»å¾ªç¯

```python
# ä¼ªä»£ç æµç¨‹ï¼ˆåŸºäºå®é™…ä»£ç æŠ½è±¡ï¼‰
for each figure/table caption:
    # 1. Anchor V2 å¤šå°ºåº¦æ‰«æ â†’ é€‰æ‹©æœ€ä¼˜baselineçª—å£ï¼ˆè“è‰²æ¡†ï¼‰
    baseline_clip = scan_multiple_heights_and_score()
    
    # 2. Phase A: æ–‡æœ¬è£åˆ‡ï¼ˆä¸‰é˜¶æ®µï¼‰
    after_a = _trim_clip_head_by_text_v2(baseline_clip)  # â†’ ç»¿è‰²æ¡†
    
    # 3. Phase B: å¯¹è±¡å¯¹é½
    after_b = _refine_clip_by_objects(after_a)  # â†’ æ©™è‰²æ¡†
    
    # 4. Phase D: åƒç´ çº§å»ç™½è¾¹ï¼ˆâš ï¸ è¿™é‡Œå®Œå…¨åŸºäºåƒç´ ï¼Œæ— è§†ç‰ˆå¼ï¼‰
    after_d = apply_autocrop(after_b, with_text_mask)  # â†’ çº¢è‰²æ¡†
    
    # 5. éªŒæ”¶æ£€æŸ¥
    if not passes_acceptance(after_d, baseline_clip):
        # å›é€€åˆ°A-onlyæˆ–baseline â†’ é»„è‰²æ¡†
        final_clip = fallback_to_safe_version()
    else:
        final_clip = after_d
    
    # 6. ç‰ˆå¼é©±åŠ¨åç½®è°ƒæ•´ï¼ˆâš ï¸ æœ€åæ‰ä»‹å…¥ï¼‰
    if layout_driven_enabled:
        final_clip = _adjust_clip_with_layout(final_clip, layout_model)
```

**å…³é”®å‘ç°**:
- Phase D (`detect_content_bbox_pixels()`) æ˜¯çº¯åƒç´ çº§æ‰«æï¼Œåªçœ‹RGBå€¼æ˜¯å¦<250ï¼ˆç™½è‰²é˜ˆå€¼ï¼‰
- è™½ç„¶æœ‰`mask_rects_px`å‚æ•°ï¼ˆæ–‡æœ¬æ©è†œï¼‰ï¼Œä½†æ©è†œæœ¬èº«ä¹Ÿæ˜¯åŸºäºå¯å‘å¼è§„åˆ™ï¼ˆ`_build_text_masks_px()`ï¼‰
- ç‰ˆå¼è°ƒæ•´æ˜¯åœ¨æœ€åæ‰æ‰§è¡Œï¼Œå¦‚æœPhase Då·²ç»åšå¾—å¾ˆå¥½ï¼Œç‰ˆå¼è°ƒæ•´å¯èƒ½ä¸ä¼šè§¦å‘

---

#### è¯æ®2ï¼šç‰ˆå¼è°ƒæ•´çš„è§¦å‘æ¡ä»¶

**ä»£ç ä½ç½®**: `_adjust_clip_with_layout()` Line 4600-4604

```python
# å¦‚æœé‡å ä¸ä¸¥é‡ï¼ˆ<20%ï¼‰ä¸”æ²¡æœ‰æ ‡é¢˜é‡å ï¼Œç›´æ¥è¿”å›
if overlap_ratio_total < 0.20 and not has_title_overlap:
    if debug:
        print(f"  -> No adjustment needed (overlap < 20%, no title overlap)")
    return clip_rect  # âš ï¸ ä¸è°ƒæ•´ï¼Œç›´æ¥è¿”å›åŸclip
```

**è§¦å‘é˜ˆå€¼**:
- å¤–éƒ¨åŒºå—é‡å åº¦ â‰¥ 20%ï¼ˆæˆ–æœ‰æ ‡é¢˜æ¥è§¦ï¼‰æ‰ä¼šè°ƒæ•´
- å¦‚æœPhase Dçš„ç»“æœåˆšå¥½ä¸æ®µè½é‡å 18%ï¼Œç‰ˆå¼è°ƒæ•´ä¸ä¼šä»‹å…¥

---

#### è¯æ®3ï¼šéªŒæ”¶å¤±è´¥å¯¼è‡´çš„å›é€€

**ä»£ç ä½ç½®**: éªŒæ”¶é€»è¾‘ï¼ˆå¤šå¤„ï¼Œå¦‚è¡¨æ ¼æå– Line ~3800-3900ï¼‰

```python
# éªŒæ”¶æ£€æŸ¥ï¼ˆ5ç»´åº¦ï¼‰
if not (height_ok and area_ok and ink_ok and coverage_ok and comp_ok):
    # å°è¯•A-only fallback
    if a_only_passes_acceptance():
        final_clip = after_a  # ä½¿ç”¨Phase Açš„ç»“æœï¼ˆç»¿è‰²æ¡†ï¼‰
    else:
        final_clip = baseline_clip  # å›é€€åˆ°baselineï¼ˆè“è‰²æ¡†ï¼‰
```

**å½±å“**:
- å¦‚æœéªŒæ”¶å¤±è´¥ï¼Œå¯èƒ½å›é€€åˆ°Phase Aæˆ–baseline
- ç‰ˆå¼è°ƒæ•´ä¼šä½œç”¨äºå›é€€åçš„clipï¼Œä½†å›é€€æœ¬èº«ä¸è€ƒè™‘ç‰ˆå¼ä¿¡æ¯

---

### ç»“è®ºï¼šæµç¨‹åœ¨3ç§æƒ…å†µä¸‹"å¿½ç•¥"ç‰ˆå¼ä¿¡æ¯

| æƒ…å†µ | é˜¶æ®µ | åŸå›  | é¢‘ç‡ä¼°è®¡ |
|------|------|------|----------|
| **ä¸»æµç¨‹** | Phase D | åƒç´ çº§å»ç™½è¾¹å®Œå…¨åŸºäºRGBï¼Œç‰ˆå¼è°ƒæ•´åœ¨ä¹‹å | 100% |
| **è§„åˆ™æœªè§¦å‘** | ç‰ˆå¼è°ƒæ•´ | é‡å åº¦<20% ä¸”æ— æ ‡é¢˜æ¥è§¦ | ~30-40% |
| **éªŒæ”¶å›é€€** | Fallback | å›é€€åˆ°A-onlyæˆ–baseline | ~10-15% |

**ä¸æ¶æ„å¸ˆç»“è®ºä¸€è‡´**: âœ…

---

## ğŸ”¬ é—®é¢˜2åˆ†æï¼šç‰ˆå¼æå–å‡†ç¡®æ€§è¯„ä¼°

### æ ¸å¿ƒé—®é¢˜ï¼šèƒ½å¦å°†å¯å‘å¼æµç¨‹æ›¿æ¢ä¸ºç‰ˆå¼é©±åŠ¨ï¼Ÿ

**æ¶æ„å¸ˆçš„å‡è®¾**: ç‰ˆå¼æ¨¡å‹ï¼ˆ`text_blocks`ï¼‰è¶³å¤Ÿå‡†ç¡®ï¼Œå¯ä»¥æ›¿ä»£å¯å‘å¼è§„åˆ™

**æˆ‘çš„è¯„ä¼°**: âš ï¸ **å‡†ç¡®æ€§å¯èƒ½ä¸è¶³ï¼Œå­˜åœ¨é‡å¤§é£é™©**

---

### å½“å‰ç‰ˆå¼æå–çš„å®ç°åˆ†æ

#### æ¨¡å—1ï¼šæ–‡æœ¬åˆ†ç±»å™¨ (`_classify_text_types()`)

**ä»£ç ä½ç½®**: Line 4030-4153

**å®ç°æ–¹æ³•**: å®Œå…¨åŸºäºè§„åˆ™çš„å¯å‘å¼åˆ†ç±»ï¼ˆæ— æœºå™¨å­¦ä¹ ï¼‰

| ç±»å‹ | åˆ¤æ–­è§„åˆ™ | å‡†ç¡®ç‡ä¼°è®¡ | é£é™©åœºæ™¯ |
|------|----------|-----------|----------|
| **Caption** | æ­£åˆ™åŒ¹é…`Figure/Table` | ~95% | ä¸­æ–‡æ··æ’ã€éæ ‡å‡†æ ¼å¼ |
| **Title** | `åŠ ç²— AND (å­—å·>1.15Ã—æ­£æ–‡)` | ~75-80% | âš ï¸ ä¸åŠ ç²—çš„æ ‡é¢˜ä¼šè¢«è¯¯åˆ¤ä¸ºæ®µè½ |
| **In-Figure Text** | `(å­—ä½“ä¸åŒ OR å­—å·å°) AND çŸ­æ–‡æœ¬ AND çª„å®½åº¦` | ~60-70% | âš ï¸ é«˜è¯¯åˆ¤ç‡ï¼Œå®¹æ˜“ä¸æ®µè½æ··æ·† |
| **Paragraph** | é»˜è®¤ç±»å‹ï¼ˆæ’é™¤æ³•ï¼‰ | ~85% | ä¸Title/In-Figureæ··æ·† |
| **List** | æ­£åˆ™åŒ¹é…bulletç‚¹ | ~90% | ç¼©è¿›æ ¼å¼ä¸æ ‡å‡† |

**ä»£ç ç¤ºä¾‹**ï¼ˆTitleæ£€æµ‹çš„å±€é™æ€§ï¼‰:

```python
# Line 4077-4106
if unit.font_weight == 'bold':  # âš ï¸ ä¾èµ–åŠ ç²—å±æ€§
    ratio = unit.font_size / typical_font_size
    if ratio > 1.3:
        unit.text_type = 'title_h1'
    elif ratio > 1.15:
        unit.text_type = 'title_h2'
    # ...
```

**é—®é¢˜**:
1. **ä¾èµ–å­—ä½“æ ‡å¿—ä½**: å¾ˆå¤šPDFçš„åŠ ç²—å±æ€§æå–ä¸å‡†ç¡®ï¼ˆå–å†³äºå­—ä½“åµŒå…¥æ–¹å¼ï¼‰
2. **é˜ˆå€¼ç¡¬ç¼–ç **: `1.15Ã—` å’Œ `1.3Ã—` æ˜¯ç»éªŒå€¼ï¼Œä¸é€‚ç”¨æ‰€æœ‰è®ºæ–‡
3. **æ— ä¸Šä¸‹æ–‡**: ä¸è€ƒè™‘å‰åè¡Œçš„å…³ç³»ï¼ˆå¦‚"æ ‡é¢˜+æ®µè½"çš„æ¨¡å¼ï¼‰

---

#### æ¨¡å—2ï¼šIn-Figure Textæ£€æµ‹ï¼ˆæœ€å±é™©ï¼‰

**ä»£ç ä½ç½®**: Line 4121-4147

```python
# åˆ¤æ–­é€»è¾‘
is_different_font = (typical_font_name not in unit.font_name)  # ç‰¹å¾1
is_small_font = unit.font_size < 0.85 * typical_font_size     # ç‰¹å¾2
is_short_text = len(text) < 30                                 # ç‰¹å¾3
is_narrow = unit.bbox.width < 0.4 * page_width                # ç‰¹å¾4

# ç»„åˆè¯„åˆ†
infig_score = 0
if is_different_font: infig_score += 2
if is_small_font: infig_score += 1
if is_short_text and is_narrow: infig_score += 1

if infig_score >= 2:
    unit.text_type = 'in_figure_text'  # âš ï¸ é«˜é£é™©åˆ†ç±»
```

**é£é™©åˆ†æ**:

| ç‰¹å¾ | å¯é æ€§ | åä¾‹åœºæ™¯ |
|------|--------|----------|
| å­—ä½“ä¸åŒ | ä¸­ç­‰ | è®ºæ–‡æ··ç”¨å­—ä½“ï¼ˆå¦‚æ­£æ–‡ç”¨Timesï¼Œå…¬å¼ç”¨Symbolï¼‰ |
| å­—å·å° | ä½ | å›¾æ³¨ã€å‚è€ƒæ–‡çŒ®ã€è„šæ³¨éƒ½æ˜¯å°å­—å· |
| çŸ­æ–‡æœ¬ | ä½ | ç« èŠ‚æ ‡é¢˜ä¹Ÿå¯èƒ½<30å­—ç¬¦ |
| çª„å®½åº¦ | ä½ | åŒæ æ’ç‰ˆçš„æ®µè½å®½åº¦å¯èƒ½<40% |

**å…¸å‹è¯¯åˆ¤åœºæ™¯**:
```
è¯¯åˆ¤ç¤ºä¾‹1ï¼šå°†å›¾æ³¨è¯¯åˆ¤ä¸ºIn-Figure Text
  è¾“å…¥: "Figure 1: Architecture overview"  (å­—å·10pt, æ­£æ–‡12pt)
  ç‰¹å¾: å­—å·å°âœ“ + çŸ­æ–‡æœ¬âœ“ = infig_score=2
  ç»“æœ: è¯¯åˆ¤ä¸ºin_figure_textï¼ˆåº”è¯¥æ˜¯caption_figureï¼‰

è¯¯åˆ¤ç¤ºä¾‹2ï¼šå°†ç« èŠ‚æ ‡é¢˜è¯¯åˆ¤ä¸ºIn-Figure Text
  è¾“å…¥: "3.2 Model Training"  (å­—ä½“Helvetica, æ­£æ–‡Times)
  ç‰¹å¾: å­—ä½“ä¸åŒâœ“ + çŸ­æ–‡æœ¬âœ“ = infig_score=3
  ç»“æœ: è¯¯åˆ¤ä¸ºin_figure_textï¼ˆåº”è¯¥æ˜¯title_h3ï¼‰
```

**åæœ**:
- å¦‚æœPhase Dä½¿ç”¨è¿™ä¸ªåˆ†ç±»ç”Ÿæˆæ–‡æœ¬æ©è†œï¼Œå¯èƒ½é”™è¯¯åœ°å±è”½å›¾æ³¨æˆ–æ ‡é¢˜
- å¦‚æœPhase Aä½¿ç”¨è¿™ä¸ªåˆ†ç±»ç§»é™¤æ–‡å­—ï¼Œå¯èƒ½è¯¯åˆ å›¾è¡¨å†…çš„é‡è¦æ–‡å­—

---

#### æ¨¡å—3ï¼šåŒæ æ£€æµ‹ (`_detect_columns()`)

**ä»£ç ä½ç½®**: Line 4156-4245

**å®ç°æ–¹æ³•**: åŸºäºx0ç›´æ–¹å›¾çš„å³°å€¼æ£€æµ‹ï¼ˆnumpy histogramï¼‰

```python
# Line 4191-4211
hist, bins = np.histogram(x0_array, bins=20)
threshold = np.mean(hist) * 1.5  # âš ï¸ ç¡¬ç¼–ç é˜ˆå€¼
peaks_idx = np.where(hist > threshold)[0]

if len(peaks_idx) >= 2:
    # é€‰æ‹©æœ€é«˜çš„ä¸¤ä¸ªå³° â†’ åŒæ 
    num_columns = 2
else:
    # å•æ 
    num_columns = 1
```

**å±€é™æ€§**:

| åœºæ™¯ | æ£€æµ‹ç»“æœ | æ­£ç¡®æ€§ |
|------|----------|--------|
| æ ‡å‡†åŒæ ï¼ˆå…¨ç¯‡ï¼‰ | åŒæ  | âœ… æ­£ç¡® |
| æ ‡å‡†å•æ ï¼ˆå…¨ç¯‡ï¼‰ | å•æ  | âœ… æ­£ç¡® |
| æ··åˆå•åŒæ ï¼ˆå¦‚é¦–é¡µæ‘˜è¦å•æ ï¼Œæ­£æ–‡åŒæ ï¼‰ | å–å†³äºé‡‡æ · | âš ï¸ å¯èƒ½è¯¯åˆ¤ |
| ä¸è§„åˆ™ç¼©è¿›ï¼ˆå¦‚åˆ—è¡¨ã€å¼•ç”¨å—ï¼‰ | å¯èƒ½å‡ºç°ä¼ªå³° | âš ï¸ å¯èƒ½è¯¯åˆ¤ä¸ºåŒæ  |
| å›¾è¡¨å†…æ–‡å­—çš„x0åˆ†å¸ƒ | å¹²æ‰°å³°å€¼ | âš ï¸ å¦‚æœé‡‡æ ·åˆ°å›¾è¡¨é¡µ |

**æ”¹è¿›ç©ºé—´**:
- åº”è¯¥æŒ‰é¡µç‹¬ç«‹æ£€æµ‹ï¼Œè€Œä¸æ˜¯å…¨æ–‡ç»Ÿä¸€
- é˜ˆå€¼`1.5Ã—mean`è¿‡äºç®€å•ï¼Œåº”è¯¥ç”¨DBSCANæˆ–GMMèšç±»

---

#### æ¨¡å—4ï¼šæ–‡æœ¬åŒºå—èšåˆ (`_build_text_blocks()`)

**ä»£ç ä½ç½®**: Line 4248-4362

**èšåˆè§„åˆ™**:
```python
# Line 4285-4296
same_type = unit.text_type == current_type
same_column = unit.column == current_column
vertical_distance = unit.bbox.y0 - prev_unit.bbox.y1
close_distance = vertical_distance < 2 * typical_line_height  # âš ï¸ ç¡¬ç¼–ç 

if same_type and same_column and close_distance:
    current_block_units.append(unit)  # èšåˆåˆ°å½“å‰åŒºå—
else:
    # åˆ›å»ºæ–°åŒºå—
```

**ä¾èµ–é“¾**:
```
æ–‡æœ¬åˆ†ç±»å‡†ç¡®æ€§ â†’ åŒºå—èšåˆè´¨é‡ â†’ ç‰ˆå¼è°ƒæ•´æ•ˆæœ
```

**é£é™©ä¼ æ’­**:
- å¦‚æœTitleè¢«è¯¯åˆ¤ä¸ºParagraph â†’ ä¼šè¢«èšåˆåˆ°æ®µè½ç»„ â†’ ç‰ˆå¼è°ƒæ•´æ— æ³•è¯†åˆ«æ ‡é¢˜
- å¦‚æœIn-Figure Textè¢«è¯¯åˆ¤ä¸ºParagraph â†’ å›¾è¡¨å†…æ–‡å­—è¢«å½“ä½œæ­£æ–‡æ®µè½ â†’ Phase Aå¯èƒ½è¯¯åˆ 

---

### å‡†ç¡®æ€§é‡åŒ–è¯„ä¼°

#### å½“å‰å‡†ç¡®æ€§ä¼°è®¡ï¼ˆåŸºäºè§„åˆ™åˆ†æ + å®æµ‹ç»éªŒï¼‰

| æŒ‡æ ‡ | ä¼°è®¡å€¼ | ä¾æ® |
|------|--------|------|
| **æ–‡æœ¬åˆ†ç±»æ€»ä½“å‡†ç¡®ç‡** | ~75-80% | Captioné«˜(95%)ï¼ŒTitleä¸­(75%)ï¼ŒIn-Figureä½(65%) |
| **Titleè¯†åˆ«å¬å›ç‡** | ~60-70% | ä¸åŠ ç²—çš„æ ‡é¢˜ä¼šæ¼åˆ¤ |
| **In-Figure Textç²¾ç¡®ç‡** | ~60% | è¯¯åˆ¤åœºæ™¯å¤šï¼ˆå›¾æ³¨ã€æ ‡é¢˜ã€è„šæ³¨ï¼‰ |
| **åŒæ æ£€æµ‹å‡†ç¡®ç‡** | ~85% | æ ‡å‡†åŒæ é«˜(95%)ï¼Œæ··åˆæ’ç‰ˆä½(70%) |
| **æ–‡æœ¬åŒºå—è¾¹ç•Œå‡†ç¡®ç‡** | ~80% | å—åˆ†ç±»å‡†ç¡®ç‡å½±å“ |

#### å¯¹æ¯”ï¼šæ·±åº¦å­¦ä¹ æ¨¡å‹çš„æœŸæœ›å‡†ç¡®ç‡

| æŒ‡æ ‡ | ä¼ ç»Ÿè§„åˆ™ | æ·±åº¦å­¦ä¹  (å¦‚LayoutLMv3) | å·®è· |
|------|----------|------------------------|------|
| æ–‡æœ¬åˆ†ç±» | 75-80% | **92-95%** | +15% |
| Titleè¯†åˆ« | 60-70% | **90-95%** | +25% |
| In-Figure Text | 60% | **85-90%** | +28% |
| åŒæ æ£€æµ‹ | 85% | **95-98%** | +12% |

---

### æ”¹é€ æ–¹æ¡ˆçš„é£é™©çŸ©é˜µ

å¦‚æœæŒ‰ç…§æ¶æ„å¸ˆçš„æ–¹æ¡ˆï¼Œè®©ç‰ˆå¼ä¿¡æ¯è´¯ç©¿æ¯ä¸ªé˜¶æ®µï¼š

| é˜¶æ®µ | ä¾èµ–çš„ç‰ˆå¼ä¿¡æ¯ | å½“å‰å‡†ç¡®ç‡ | è¯¯åˆ¤åæœ | é£é™©ç­‰çº§ |
|------|--------------|-----------|----------|----------|
| **é”šç‚¹é€‰æ‹©** | `vacant_regions` | ~80% | åˆå§‹çª—å£åç§»/é—æ¼å›¾è¡¨ | ğŸŸ¡ ä¸­ç­‰ |
| **Phase A** | `text_blocks` (æ®µè½/æ ‡é¢˜) | ~80% | è¯¯åˆ å›¾è¡¨å†…æ–‡å­—/ä¿ç•™æ­£æ–‡ | ğŸ”´ é«˜ |
| **Phase B** | `in_figure_text` | ~60% | è¯¯åˆ¤å›¾å†…å¤–è¾¹ç•Œ | ğŸ”´ **æé«˜** |
| **Phase D** | `text_blocks` (ç”Ÿæˆæ©è†œ) | ~80% | æ©è†œé”™è¯¯â†’å»ç™½è¾¹å¤±è´¥ | ğŸŸ¡ ä¸­ç­‰ |

**æœ€å±é™©çš„ç¯èŠ‚**: Phase Bï¼ˆå¯¹è±¡å¯¹é½ï¼‰ä¾èµ–`in_figure_text`æ£€æµ‹ï¼Œä½†è¯¥æ¨¡å—å‡†ç¡®ç‡ä»…60%

---

### å®æµ‹æ¡ˆä¾‹ä½è¯ï¼ˆåŸºäºç°æœ‰æµ‹è¯•é›†ï¼‰

#### æ¡ˆä¾‹1ï¼šDeepSeek_V3_2.pdf

**è§‚å¯Ÿ**: å½“å‰ç‰ˆæœ¬ï¼ˆå¯å‘å¼A+B+D + åç½®ç‰ˆå¼è°ƒæ•´ï¼‰å·²è¾¾åˆ°92%å‡†ç¡®ç‡

**å¦‚æœæ”¹ä¸ºç‰ˆå¼é©±åŠ¨**:

| å›¾è¡¨ | å½“å‰ç»“æœ | ç‰ˆå¼é©±åŠ¨é¢„æµ‹ | åˆ†æ |
|------|----------|-------------|------|
| Figure 1 | âœ… å®Œæ•´ | âœ… é¢„è®¡æ­£å¸¸ | æ ‡å‡†æ’ç‰ˆï¼Œæ ‡é¢˜è¯†åˆ«å‡†ç¡® |
| Figure 4 (MHA/MQA) | âœ… å®Œæ•´ï¼ˆå¤šå­å›¾ï¼‰ | âš ï¸ é£é™©ï¼šå­å›¾æ ‡ç­¾å¯èƒ½è¢«è¯¯åˆ¤ä¸ºin_figure | å­å›¾æ ‡ç­¾"(a) MHA"å¯èƒ½è¢«å±è”½ |
| Table 1 | âœ… å®Œæ•´ | âœ… é¢„è®¡æ­£å¸¸ | è¡¨æ ¼å†…æ–‡å­—è¢«æ­£ç¡®è¯†åˆ« |

---

#### æ¡ˆä¾‹2ï¼šFunAudio-ASR.pdf

**è§‚å¯Ÿ**: Phase A3æˆåŠŸç§»é™¤äº†Abstractæ®µè½ï¼ˆè¿œè·æ–‡å­—æ¸…é™¤ï¼‰

**å¦‚æœæ”¹ä¸ºç‰ˆå¼é©±åŠ¨**:

| å›¾è¡¨ | å½“å‰ç»“æœ | ç‰ˆå¼é©±åŠ¨é¢„æµ‹ | åˆ†æ |
|------|----------|-------------|------|
| Figure 1 | âœ… ä¸Šæ–¹Abstractè¢«ç§»é™¤ | âœ… é¢„è®¡æ­£å¸¸ | `paragraph_group`è¯†åˆ«å‡†ç¡® |
| Figure 3 | âœ… ä¸Šæ–¹æ­£æ–‡è¢«ç§»é™¤ | âš ï¸ é£é™©ï¼šå¦‚æœæ®µè½è¢«è¯¯åˆ¤ä¸ºTitle | å¯èƒ½ä¿ç•™è¿‡å¤šæ–‡å­— |
| Table 3 | âœ… å®Œæ•´ | âš ï¸ é£é™©ï¼šè¡¨å¤´å¯èƒ½è¢«è¯¯åˆ¤ä¸ºæ ‡é¢˜ | è¡¨å¤´è¢«ç§»é™¤â†’è¡¨æ ¼æˆªæ–­ |

---

#### æ¡ˆä¾‹3ï¼šAttention is All You Need (transformerè®ºæ–‡)

**å‡è®¾åœºæ™¯**ï¼ˆåŸºäºå…¸å‹é—®é¢˜ï¼‰:

| å…ƒç´  | ç‰ˆå¼åˆ†ç±»é¢„æµ‹ | å¯èƒ½è¯¯åˆ¤ | åæœ |
|------|------------|----------|------|
| å¤šå¤´æ³¨æ„åŠ›å­å›¾æ ‡ç­¾ "(h=8)" | `in_figure_text` | âŒ å¯èƒ½è¢«è¯¯åˆ¤ä¸º`paragraph` | Phase Aè¯¯åˆ  |
| å…¬å¼ç¼–å· "(1)" | `equation` | âŒ å¯èƒ½è¢«è¯¯åˆ¤ä¸º`list` | Phase Aè¯¯åˆ  |
| ç« èŠ‚æ ‡é¢˜ "3.5 Positional Encoding" | `title_h3` | âŒ å¦‚æœä¸åŠ ç²—â†’è¯¯åˆ¤ä¸º`paragraph` | è¢«èšåˆåˆ°æ®µè½â†’ç‰ˆå¼è°ƒæ•´å¤±æ•ˆ |

---

## ğŸ“Š æ”¹é€ æ–¹æ¡ˆçš„å¯è¡Œæ€§è¯„ä¼°

### æ€»ä½“ç»“è®ºï¼šğŸŸ¡ **éƒ¨åˆ†å¯è¡Œï¼Œä½†éœ€è¦åˆ†é˜¶æ®µæ¨è¿›**

| é˜¶æ®µ | æ”¹é€ å¯è¡Œæ€§ | æ¨èç­–ç•¥ | ä¼˜å…ˆçº§ |
|------|-----------|----------|--------|
| **Phase D (æ–‡æœ¬æ©è†œ)** | âœ… å¯è¡Œ | ç”¨`text_blocks`ç”Ÿæˆæ©è†œï¼Œæ›¿ä»£å¯å‘å¼ | ğŸŸ¢ é«˜ï¼ˆé£é™©ä½ï¼Œæ•ˆæœç›´è§‚ï¼‰ |
| **é”šç‚¹é€‰æ‹©** | âœ… å¯è¡Œ | ç”¨`vacant_regions`ä¼˜åŒ–æœç´¢ç©ºé—´ | ğŸŸ¢ é«˜ï¼ˆæå‡æ€§èƒ½ï¼‰ |
| **Phase A (æ–‡æœ¬è£åˆ‡)** | âš ï¸ è°¨æ… | ä¸å¯å‘å¼**å¹¶è¡Œ**è¿è¡Œï¼Œå–äº¤é›† | ğŸŸ¡ ä¸­ï¼ˆéœ€è¦éªŒè¯ï¼‰ |
| **Phase B (å¯¹è±¡å¯¹é½)** | âŒ ä¸å»ºè®® | `in_figure_text`å‡†ç¡®ç‡ä¸è¶³ï¼ˆ60%ï¼‰ | ğŸ”´ ä½ï¼ˆé£é™©æé«˜ï¼‰ |

---

### æ¨èçš„æ¸è¿›å¼æ”¹é€ è·¯çº¿å›¾

#### ç¬¬ä¸€é˜¶æ®µï¼šä½é£é™©æ¨¡å—ï¼ˆé¢„è®¡2å‘¨ï¼‰

**ç›®æ ‡**: æå‡Phase Då’Œé”šç‚¹é€‰æ‹©

```python
# 1. Phase D: ç”¨ç‰ˆå¼æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ©è†œ
def _build_text_masks_px_v2(layout_model, page_num, clip_rect, dpi):
    """ä½¿ç”¨text_blocksæ›¿ä»£å¯å‘å¼è§„åˆ™"""
    mask_rects = []
    text_blocks = layout_model.text_blocks.get(page_num, [])
    
    for block in text_blocks:
        # åªæ©è†œæ®µè½å’Œæ ‡é¢˜ï¼Œä¸æ©è†œin_figure_text
        if block.block_type in ['paragraph_group', 'list_group', 'title_h1', 'title_h2', 'title_h3']:
            # æ£€æŸ¥blockæ˜¯å¦åœ¨è¿‘ä¾§åŒºåŸŸï¼ˆé è¿‘captionçš„60%ï¼‰
            if is_in_near_side(block.bbox, clip_rect, direction, near_frac=0.6):
                # è½¬æ¢ä¸ºåƒç´ åæ ‡
                px_rect = pt_to_px(block.bbox, dpi)
                mask_rects.append(px_rect)
    
    return mask_rects
```

**ä¼˜ç‚¹**:
- æ–‡æœ¬æ©è†œçš„é”™è¯¯ä¸ä¼šå¯¼è‡´ç¾éš¾æ€§åæœï¼ˆæœ€å¤šæ˜¯å»ç™½è¾¹ä¸å¤Ÿå½»åº•ï¼‰
- å®¹æ˜“å›é€€ï¼ˆä¿ç•™æ—§ç‰ˆæœ¬`_build_text_masks_px()`ä½œä¸ºfallbackï¼‰

---

#### ç¬¬äºŒé˜¶æ®µï¼šå¢å¼ºç‰ˆå¼æå–ï¼ˆé¢„è®¡3-4å‘¨ï¼‰

**ç›®æ ‡**: æå‡æ–‡æœ¬åˆ†ç±»å‡†ç¡®ç‡è‡³85%+

**ä¼˜åŒ–æ–¹å‘**:

1. **Titleæ£€æµ‹å¢å¼º**ï¼ˆè§£å†³60%â†’85%ï¼‰:
```python
# æ·»åŠ ä¸Šä¸‹æ–‡ç‰¹å¾
def _enhance_title_detection(units, typical_line_height):
    for i, unit in enumerate(units):
        # ç‰¹å¾1ï¼šä½ç½®ç‰¹å¾ï¼ˆå¦‚æœåé¢ç´§è·Ÿæ®µè½ï¼Œå¯èƒ½æ˜¯æ ‡é¢˜ï¼‰
        next_unit = units[i+1] if i+1 < len(units) else None
        if next_unit and next_unit.text_type == 'paragraph':
            gap = next_unit.bbox.y0 - unit.bbox.y1
            if 0.5 * typical_line_height < gap < 1.5 * typical_line_height:
                unit.text_type = 'title_h3'
                unit.confidence = 0.80
        
        # ç‰¹å¾2ï¼šç¼–å·æ¨¡å¼ï¼ˆå¦‚ "3.2 Model"ï¼‰
        if re.match(r'^\d+(\.\d+)+\s+[A-Z]', unit.text):
            unit.text_type = 'title_h3'
            unit.confidence = 0.85
```

2. **In-Figure Textæ£€æµ‹å¢å¼º**ï¼ˆè§£å†³60%â†’75%ï¼‰:
```python
# æ·»åŠ ç©ºé—´èšç±»ï¼ˆå›¾è¡¨å†…æ–‡å­—é€šå¸¸ç©ºé—´èšé›†ï¼‰
def _enhance_infigure_detection(units, drawings, images):
    for unit in units:
        # æ£€æŸ¥æ˜¯å¦è¢«å›¾å½¢å¯¹è±¡åŒ…å›´
        surrounded_score = count_surrounding_objects(unit.bbox, drawings, images)
        if surrounded_score > 0.7:  # 70%çš„é‚»åŸŸæœ‰å›¾å½¢å¯¹è±¡
            unit.text_type = 'in_figure_text'
            unit.confidence = 0.75
```

3. **åŒæ æ£€æµ‹å¢å¼º**ï¼ˆè§£å†³85%â†’95%ï¼‰:
```python
# æŒ‰é¡µç‹¬ç«‹æ£€æµ‹ + DBSCANèšç±»
from sklearn.cluster import DBSCAN

def _detect_columns_per_page(units_per_page):
    x0_values = [u.bbox.x0 for u in units_per_page if u.text_type == 'paragraph']
    if len(x0_values) < 10:
        return 1, 0.0  # å•æ 
    
    # DBSCANèšç±»
    clustering = DBSCAN(eps=30, min_samples=3).fit(np.array(x0_values).reshape(-1, 1))
    num_clusters = len(set(clustering.labels_)) - (1 if -1 in clustering.labels_ else 0)
    
    return (2 if num_clusters >= 2 else 1), compute_gap(clustering)
```

---

#### ç¬¬ä¸‰é˜¶æ®µï¼šPhase Aæ”¹é€ ï¼ˆé¢„è®¡2å‘¨ï¼‰

**ç›®æ ‡**: ç”¨ç‰ˆå¼ä¿¡æ¯è¾…åŠ©æ–‡æœ¬è£åˆ‡ï¼Œä½†ä¿ç•™å¯å‘å¼ä½œä¸ºéªŒè¯

```python
def _trim_clip_head_by_text_v3(clip_rect, layout_model, page_num, direction, fallback_mode='å¯å‘å¼'):
    """ç‰ˆå¼é©±åŠ¨ + å¯å‘å¼åŒé‡éªŒè¯"""
    
    # æ–¹æ³•1ï¼šç‰ˆå¼é©±åŠ¨
    text_blocks = layout_model.text_blocks.get(page_num, [])
    layout_trim = identify_blocks_to_remove(text_blocks, clip_rect, direction)
    
    # æ–¹æ³•2ï¼šå¯å‘å¼ï¼ˆåŸPhase Aé€»è¾‘ï¼‰
    heuristic_trim = original_trim_logic(clip_rect, text_lines, direction)
    
    # ä¸€è‡´æ€§æ£€æŸ¥
    if abs(layout_trim.height - heuristic_trim.height) / clip_rect.height < 0.15:
        # ä¸¤è€…ç»“æœæ¥è¿‘ï¼ˆå·®å¼‚<15%ï¼‰ï¼Œä½¿ç”¨ç‰ˆå¼é©±åŠ¨
        return layout_trim
    else:
        # ç»“æœå·®å¼‚å¤§ï¼Œä½¿ç”¨ä¿å®ˆç­–ç•¥ï¼ˆå–å¹¶é›†æˆ–å¯å‘å¼ï¼‰
        if fallback_mode == 'å¯å‘å¼':
            return heuristic_trim
        else:
            return take_intersection(layout_trim, heuristic_trim)
```

---

#### ç¬¬å››é˜¶æ®µï¼ˆå¯é€‰ï¼‰ï¼šæ·±åº¦å­¦ä¹ å‡çº§

**é•¿æœŸæ–¹æ¡ˆ**: å¼•å…¥è½»é‡çº§æ–‡æ¡£å¸ƒå±€æ¨¡å‹ï¼ˆå¦‚LayoutLMv3çš„è’¸é¦ç‰ˆæœ¬ï¼‰

**é¢„æœŸæå‡**:
- æ–‡æœ¬åˆ†ç±»å‡†ç¡®ç‡: 80% â†’ **95%**
- In-Figure Textç²¾ç¡®ç‡: 65% â†’ **90%**
- åŒæ æ£€æµ‹å‡†ç¡®ç‡: 85% â†’ **98%**

**å®æ–½éš¾åº¦**:
- éœ€è¦GPUæ¨ç†ï¼ˆæˆ–ä¼˜åŒ–ä¸ºCPUå¯ç”¨çš„é‡åŒ–æ¨¡å‹ï¼‰
- å¢åŠ ä¾èµ–ï¼ˆtransformers, torchï¼‰
- å¢åŠ åˆå§‹åŒ–æ—¶é—´ï¼ˆæ¨¡å‹åŠ è½½çº¦3-5ç§’ï¼‰

---

## ğŸ¯ æœ€ç»ˆå»ºè®®

### å¯¹æ¶æ„å¸ˆæ–¹æ¡ˆçš„è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **ç†è®ºæ­£ç¡®æ€§** | â­â­â­â­â­ | æ–¹æ¡ˆè®¾è®¡éå¸¸åˆç†ï¼Œç¬¦åˆ"æ•°æ®é©±åŠ¨"ç†å¿µ |
| **å®æ–½é£é™©** | â­â­â˜†â˜†â˜† | å½“å‰ç‰ˆå¼æå–å‡†ç¡®ç‡ä¸è¶³ï¼Œé£é™©è¾ƒé«˜ |
| **æ”¶ç›Šé¢„æœŸ** | â­â­â­â­â˜† | å¦‚æœå‡†ç¡®ç‡è¾¾æ ‡ï¼Œé¢„è®¡å‡†ç¡®ç‡æå‡5-8% |
| **å®æ–½éš¾åº¦** | â­â­â­â˜†â˜† | ä¸­ç­‰éš¾åº¦ï¼Œéœ€è¦4-6å‘¨å®Œæ•´å®æ–½ |

### æˆ‘ä¸æ¶æ„å¸ˆçš„åˆ†æ­§ç‚¹

| é—®é¢˜ | æ¶æ„å¸ˆè§‚ç‚¹ | æˆ‘çš„è§‚ç‚¹ | æ ¸å¿ƒåˆ†æ­§ |
|------|----------|----------|----------|
| **é—®é¢˜1** | âœ… å®Œå…¨ä¸€è‡´ | âœ… å®Œå…¨ä¸€è‡´ | æ— åˆ†æ­§ |
| **é—®é¢˜2ï¼ˆå¯è¡Œæ€§ï¼‰** | "æ–¹æ¡ˆéå¸¸å¯è¡Œ" | "éƒ¨åˆ†å¯è¡Œï¼Œéœ€è°¨æ…" | **ç‰ˆå¼å‡†ç¡®æ€§è¯„ä¼°** |
| **é—®é¢˜2ï¼ˆé£é™©ï¼‰** | "å¼ºä¾èµ–ç‰ˆå¼è´¨é‡" | "**é£é™©æ¯”é¢„æœŸå¤§**" | **é£é™©ç¨‹åº¦åˆ¤æ–­** |
| **é—®é¢˜2ï¼ˆå®æ–½ï¼‰** | "ä»Phase Då¼€å§‹" | âœ… åŒæ„ï¼Œä½†åŠ å¼ºéªŒè¯ | åŸºæœ¬ä¸€è‡´ |

### å…³é”®å·®å¼‚ï¼šæ¶æ„å¸ˆå¯èƒ½**ä½ä¼°äº†In-Figure Textæ£€æµ‹çš„é£é™©**

**æ¶æ„å¸ˆçš„å‡è®¾**:
> "Phase B: åˆ©ç”¨ç‰ˆå¼ä¿¡æ¯åˆ¤æ–­å›¾å†…å¤–å…ƒç´ "

**æˆ‘çš„æ‹…å¿§**:
- å½“å‰`in_figure_text`æ£€æµ‹åªæœ‰**60%ç²¾ç¡®ç‡**
- å¦‚æœPhase Bä¾èµ–è¿™ä¸ªåˆ†ç±»ï¼Œå¯èƒ½å¯¼è‡´**å›¾è¡¨è¾¹ç•Œè¯¯åˆ¤**
- å½±å“é¢ç§¯ï¼šPhase Bæ˜¯éªŒæ”¶ä¿æŠ¤çš„å…³é”®ç¯èŠ‚ï¼Œè¯¯åˆ¤ä¼šè§¦å‘fallback

---

### æˆ‘çš„æœ€ç»ˆå»ºè®®ï¼ˆ5ç‚¹ï¼‰

#### 1ï¸âƒ£ é‡‡çº³æ¶æ„å¸ˆçš„æ€»ä½“æ€è·¯ï¼Œä½†**åˆ†é˜¶æ®µã€å¯å›é€€**

- âœ… ç¬¬ä¸€é˜¶æ®µï¼šPhase Dï¼ˆæ–‡æœ¬æ©è†œï¼‰ + é”šç‚¹é€‰æ‹©
- âœ… ç¬¬äºŒé˜¶æ®µï¼šå¢å¼ºç‰ˆå¼æå–ï¼ˆæå‡å‡†ç¡®ç‡è‡³85%+ï¼‰
- âš ï¸ ç¬¬ä¸‰é˜¶æ®µï¼šPhase Aï¼ˆåŒé‡éªŒè¯æ¨¡å¼ï¼‰
- âŒ æš‚ç¼“ï¼šPhase Bï¼ˆç­‰å¾…`in_figure_text`å‡†ç¡®ç‡æå‡è‡³80%+ï¼‰

---

#### 2ï¸âƒ£ å»ºç«‹ç‰ˆå¼æå–çš„**è´¨é‡è¯„ä¼°ä½“ç³»**

```python
# æ–°å¢å·¥å…·ï¼šç‰ˆå¼åˆ†ç±»å‡†ç¡®ç‡è¯„ä¼°
def evaluate_layout_quality(pdf_path, ground_truth_json):
    """
    å¯¹æ¯”ç‰ˆå¼æå–ç»“æœä¸ground truth
    
    è¾“å‡º:
    - æ–‡æœ¬åˆ†ç±»æ··æ·†çŸ©é˜µ
    - Titleå¬å›ç‡/ç²¾ç¡®ç‡
    - In-Figure Text F1åˆ†æ•°
    - åŒæ æ£€æµ‹å‡†ç¡®ç‡
    """
    layout_model = extract_text_with_format(pdf_path)
    predicted = layout_model.text_units
    gt = load_ground_truth(ground_truth_json)
    
    metrics = compute_classification_metrics(predicted, gt)
    print(f"Title Recall: {metrics['title_recall']:.2%}")
    print(f"In-Figure Precision: {metrics['infig_precision']:.2%}")
    print(f"Overall Accuracy: {metrics['accuracy']:.2%}")
    
    return metrics
```

**ä½¿ç”¨æ–¹æ³•**:
```bash
# ä¸ºæµ‹è¯•é›†ä¸­çš„PDFæ ‡æ³¨ground truth
python scripts/annotate_layout.py --pdf DeepSeek_V3_2.pdf

# è¯„ä¼°ç‰ˆå¼æå–è´¨é‡
python scripts/evaluate_layout_quality.py --pdf DeepSeek_V3_2.pdf --gt layout_gt.json
```

---

#### 3ï¸âƒ£ ä¿ç•™**é€ƒç”Ÿèˆ±**å‚æ•°

```bash
# æ–°å¢å‚æ•°
--layout-driven-phase       # æŒ‡å®šå“ªäº›é˜¶æ®µå¯ç”¨ç‰ˆå¼é©±åŠ¨ï¼ˆa,b,d,anchorï¼‰
--layout-fallback-threshold # ç‰ˆå¼ä¸å¯å‘å¼ç»“æœå·®å¼‚é˜ˆå€¼ï¼ˆé»˜è®¤0.15ï¼‰
--min-layout-confidence     # æ–‡æœ¬åˆ†ç±»æœ€å°ç½®ä¿¡åº¦ï¼ˆé»˜è®¤0.70ï¼‰

# ç¤ºä¾‹
python3 scripts/extract_pdf_assets.py \
  --pdf paper.pdf \
  --preset robust \
  --layout-driven-phase d,anchor \    # ä»…Phase Då’Œé”šç‚¹ä½¿ç”¨ç‰ˆå¼
  --layout-fallback-threshold 0.20    # å·®å¼‚>20%æ—¶å›é€€åˆ°å¯å‘å¼
```

---

#### 4ï¸âƒ£ å¢å¼º`debug-visual`æ¨¡å¼ï¼Œå¯è§†åŒ–ç‰ˆå¼åˆ†ç±»ç»“æœ

**å½“å‰**: æ˜¾ç¤ºæ–‡æœ¬åŒºå—è¾¹ç•Œï¼ˆç²‰è‰²æ¡†ï¼‰  
**å¢å¼º**: æ ‡æ³¨æ¯ä¸ªæ–‡æœ¬å•å…ƒçš„ç±»å‹å’Œç½®ä¿¡åº¦

```python
# åœ¨debugå¯è§†åŒ–ä¸­æ·»åŠ æ–‡æœ¬ç±»å‹æ ‡ç­¾
for unit in text_units:
    draw_bbox(unit.bbox, color='pink', style='dashed')
    draw_label(unit.bbox.tl, f"{unit.text_type} ({unit.confidence:.2f})")  # æ–°å¢
```

**æ•ˆæœç¤ºä¾‹**:
```
images/debug/Figure_3_p5_debug_stages.png
  - ç²‰è‰²è™šçº¿æ¡† + æ ‡ç­¾ "paragraph_group (0.85)"
  - ç²‰è‰²å®çº¿æ¡† + æ ‡ç­¾ "title_h2 (0.90)"
  - ç°è‰²æ¡† + æ ‡ç­¾ "in_figure_text (0.65)" â† ä½ç½®ä¿¡åº¦è­¦å‘Š
```

---

#### 5ï¸âƒ£ å»ºç«‹**A/Bæµ‹è¯•æµç¨‹**

```python
# æ‰¹é‡å¯¹æ¯”æµ‹è¯•ï¼ˆå¯å‘å¼ vs ç‰ˆå¼é©±åŠ¨ï¼‰
def ab_test_extraction(pdf_list, mode_a='heuristic', mode_b='layout_driven'):
    results = []
    for pdf in pdf_list:
        # è¿è¡Œä¸¤ç§æ¨¡å¼
        result_a = extract_with_mode(pdf, mode_a)
        result_b = extract_with_mode(pdf, mode_b)
        
        # å¯¹æ¯”å·®å¼‚
        diff = compare_results(result_a, result_b)
        results.append({
            'pdf': pdf,
            'mode_a_accuracy': result_a.accuracy,
            'mode_b_accuracy': result_b.accuracy,
            'improvement': diff.improvement,
            'risk_cases': diff.failed_in_b
        })
    
    # è¾“å‡ºç»Ÿè®¡æŠ¥å‘Š
    print(f"Mode B æå‡æ¡ˆä¾‹: {count_improvements(results)}")
    print(f"Mode B é€€åŒ–æ¡ˆä¾‹: {count_regressions(results)}")
    print(f"å¹³å‡å‡†ç¡®ç‡æå‡: {mean_improvement(results):.2%}")
```

---

## ğŸ“ æ€»ç»“

### å›ç­”ç”¨æˆ·çš„ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜

#### é—®é¢˜1ï¼šä»€ä¹ˆæ—¶å€™ä¼šå¿½ç•¥ç‰ˆå¼ä¿¡æ¯ï¼Ÿ

**ç­”æ¡ˆ**: âœ… ä¸æ¶æ„å¸ˆç»“è®º**å®Œå…¨ä¸€è‡´**

1. **ä¸»æµç¨‹ï¼ˆ100%ï¼‰**: Phase Dåƒç´ çº§å»ç™½è¾¹å®Œå…¨åŸºäºRGBï¼Œç‰ˆå¼è°ƒæ•´åœ¨ä¹‹å
2. **è§„åˆ™æœªè§¦å‘ï¼ˆ30-40%ï¼‰**: é‡å åº¦<20%ä¸”æ— æ ‡é¢˜æ¥è§¦
3. **éªŒæ”¶å›é€€ï¼ˆ10-15%ï¼‰**: å›é€€åˆ°A-onlyæˆ–baseline

---

#### é—®é¢˜2ï¼šç‰ˆå¼å‡†ç¡®æ€§æ˜¯å¦è¶³å¤Ÿæ”¯æ’‘å¤§å˜åŒ–ï¼Ÿ

**ç­”æ¡ˆ**: âš ï¸ ä¸æ¶æ„å¸ˆè§‚ç‚¹**æœ‰åˆ†æ­§**

- **æ¶æ„å¸ˆ**: "æ–¹æ¡ˆéå¸¸å¯è¡Œ"ï¼ˆå¼ºä¾èµ–ç‰ˆå¼è´¨é‡ï¼Œä½†è®¤ä¸ºå¯æ¥å—ï¼‰
- **æˆ‘çš„è¯„ä¼°**: "**éƒ¨åˆ†å¯è¡Œï¼Œéœ€è°¨æ…æ¨è¿›**"ï¼ˆå‡†ç¡®ç‡75-80%ä¸è¶³ï¼Œé£é™©è¾ƒé«˜ï¼‰

**æ ¸å¿ƒåˆ†æ­§**:
- æ¶æ„å¸ˆå¯èƒ½**ä½ä¼°äº†In-Figure Textæ£€æµ‹çš„é£é™©**ï¼ˆ60%ç²¾ç¡®ç‡ï¼‰
- æ¶æ„å¸ˆå¯èƒ½**é«˜ä¼°äº†Titleæ£€æµ‹çš„å‡†ç¡®ç‡**ï¼ˆå®é™…60-70%å¬å›ç‡ï¼‰

**æˆ‘çš„å»ºè®®**:
- âœ… æ€»ä½“æ–¹å‘æ­£ç¡®ï¼Œä½†éœ€è¦**åˆ†é˜¶æ®µã€å¯å›é€€ã€A/Bæµ‹è¯•**
- âœ… ä¼˜å…ˆæ”¹é€ ä½é£é™©æ¨¡å—ï¼ˆPhase D, é”šç‚¹ï¼‰
- âš ï¸ Phase Aéœ€è¦åŒé‡éªŒè¯ï¼ˆç‰ˆå¼ + å¯å‘å¼ï¼‰
- âŒ **æš‚ç¼“Phase Bæ”¹é€ **ï¼ˆç­‰å¾…`in_figure_text`å‡†ç¡®ç‡æå‡è‡³80%+ï¼‰

---

## ğŸ”— åç»­è¡ŒåŠ¨

### ç«‹å³å¯æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰

1. âœ… ä¸ºæµ‹è¯•é›†PDFæ ‡æ³¨ç‰ˆå¼åˆ†ç±»ground truthï¼ˆ3ä¸ªæ ·æœ¬ï¼‰
2. âœ… å®æ–½ç‰ˆå¼è´¨é‡è¯„ä¼°å·¥å…·ï¼ˆ`evaluate_layout_quality.py`ï¼‰
3. âœ… åˆ†æå½“å‰ç‰ˆå¼æå–çš„å‡†ç¡®ç‡ç“¶é¢ˆ

### è¿‘æœŸè§„åˆ’ï¼ˆ2å‘¨å†…ï¼‰

1. âœ… æ”¹é€ Phase Dæ–‡æœ¬æ©è†œï¼ˆä½¿ç”¨`text_blocks`ï¼‰
2. âœ… æ”¹é€ é”šç‚¹é€‰æ‹©ï¼ˆä½¿ç”¨`vacant_regions`ï¼‰
3. âœ… å¢å¼º`debug-visual`å¯è§†åŒ–ï¼ˆæ ‡æ³¨æ–‡æœ¬ç±»å‹ï¼‰
4. âœ… å»ºç«‹A/Bæµ‹è¯•æµç¨‹

### ä¸­æœŸç›®æ ‡ï¼ˆ4-6å‘¨å†…ï¼‰

1. âš ï¸ å¢å¼ºæ–‡æœ¬åˆ†ç±»å‡†ç¡®ç‡ï¼ˆTitle: 85%, In-Figure: 75%ï¼‰
2. âš ï¸ æ”¹é€ Phase Aï¼ˆåŒé‡éªŒè¯æ¨¡å¼ï¼‰
3. âš ï¸ å¯¹10ç¯‡è®ºæ–‡è¿›è¡ŒA/Bæµ‹è¯•
4. âš ï¸ æ ¹æ®æµ‹è¯•ç»“æœå†³å®šæ˜¯å¦ç»§ç»­Phase Bæ”¹é€ 

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-27  
**ä¸‹æ¬¡å®¡æŸ¥**: 2025-11-10ï¼ˆPhase Dæ”¹é€ å®Œæˆåï¼‰  
**å®¡æ ¸çŠ¶æ€**: âœ… æŠ€æœ¯å®¡æŸ¥å®Œæˆï¼Œç­‰å¾…ç”¨æˆ·å†³ç­–

